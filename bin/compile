#!/bin/sh

indent() {
  sed -u 's/^/       /'
}

echo "-----> Checking node version"
node -v | indent
echo "-----> Checking npm version"
npm -v | indent

echo "-----> Installing ember-cli"
npm -g install bower ember-cli 2>&1 | indent

echo "-----> Install packages and build BD ember admin app"
cd $1/ember_admin
npm install 2>&1 | indent
bower install 2>&1 | indent
ember build --environment=production | indent
cd ..

echo "-----> Copying assets in rails public folder"
# copy all files from the dist folder into assets
rm -rf $1/public/ember/assets/*
rm -rf $1/public/ember/fonts/*
rm -rf $1/public/images/ember/*

cp -Rf $1/ember_admin/dist/assets $1/public/ember
cp -Rf $1/ember_admin/dist/fonts $1/public/ember
cp -Rf $1/ember_admin/dist/images/ember $1/public/images/ember

bin/ember_plugger $1
